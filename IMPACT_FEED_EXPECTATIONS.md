# Impact Feed Expectations

## Overview
The Impact Feed displays dynamic content including projects, opportunities, campaigns, milestones, and success stories. This document outlines the exact data structure and requirements for feed items.

## FeedItem Interface

```typescript
interface FeedItem {
  // Required Fields
  id: string;                    // Unique identifier (e.g., "feed_project_123")
  type: 'project' | 'campaign' | 'opportunity' | 'milestone' | 'success_story' | 
        'funding_success' | 'live_event' | 'workroom_live' | 'project_closing' | 
        'admin_highlight' | 'achievement' | 'certification' | 'collaboration';
  title: string;                 // Display title (prefixes like "New Project: " are auto-removed)
  timestamp: string;             // ISO date string (e.g., "2024-01-15T10:30:00Z")
  likes: number;                 // Initial like count (default: 0)
  location: string;              // Location string (e.g., "New York, NY" or "Global")
  category: string;              // Category name (e.g., "Education", "Healthcare")
  authorId: string;              // User ID of the author
  authorName: string;            // Display name of the author
  visibility: 'public' | 'authenticated' | 'private';  // Who can see this
  significance: 'low' | 'medium' | 'high' | 'critical'; // Priority level
  
  // Optional Fields
  description?: string;          // Main content/description text
  urgent?: boolean;              // Shows urgent badge if true
  deadline?: string;             // Deadline date string (shown in urgent badge)
  isLive?: boolean;              // Shows "LIVE" badge if true
  isPinned?: boolean;            // Shows pin icon if true
  isAdminCurated?: boolean;      // Shows "FEATURED" badge if true
  authorAvatar?: string;         // URL to author's avatar image
  projectId?: string;            // ID of related project (for navigation)
  campaignId?: string;           // ID of related campaign
  opportunityId?: string;        // ID of related opportunity
  isAutoGenerated?: boolean;     // Whether item was auto-generated
  
  // Metadata (Optional but Important)
  metadata?: {
    // Project-specific
    university?: string;
    tags?: string[];
    aspiraCategory?: string;     // 'mentorships' | 'research' | 'community-service' | 'university-campaigns'
    team?: Array<{id: string; name: string; role: string; avatar?: string}>;
    status?: string;              // 'active' | 'closed' | 'planning'
    seekingSupport?: string[];    // Types of support needed
    applicants?: number;          // Number of applicants/interested users
    comments?: number;            // Number of comments
    
    // Opportunity-specific
    type?: string;                // 'scholarship' | 'job' | 'internship' | etc.
    company?: string;
    remote?: boolean;
    amount?: {value: number; currency: string; type: string};
    experienceLevel?: string;
    
    // General
    completionDate?: string;
    progress?: number;
    milestoneId?: string;
    projectTitle?: string;
    dueDate?: string;
    expiresAt?: string;           // For admin highlights
    [key: string]: any;           // Additional custom fields
  };
}
```

## How Feed Items Are Displayed

### 1. **Card Header**
- **Avatar**: Uses `authorAvatar` or generates from `authorName` first letter
- **Author Name**: Displays `authorName` with "(You)" badge if `authorId === currentUserId`
- **Location**: Shows `location` with map pin icon
- **Timestamp**: Displays formatted `timestamp`
- **Category**: Shows `category` as a badge
- **Featured Badge**: Purple "FEATURED" badge if `isAdminCurated === true`
- **Pin Icon**: Red pin icon in top-right if `isPinned === true`

### 2. **Urgency Indicators**
- **Urgent Badge**: Red pulsing badge with deadline if `urgent === true`
- **Live Badge**: Red "LIVE" badge if `isLive === true`

### 3. **Content Section**
- **Icon**: Type-specific icon based on `type` field
- **Title**: `title` (prefixes like "New Project: " are auto-removed)
- **Description**: `description` shown in collapsible format (max 120 chars initially)
- **Narrative**: Auto-generated story narrative based on `type` and metadata

### 4. **Interactive Elements**
- **Interest Tracker**: Shows for `type === 'project'` or `type === 'opportunity'`
  - Uses `metadata.applicants` or `likes` as initial count
- **Impact Metrics**: Displayed based on `type` and `metadata`
- **Like Button**: Uses `likes` count
- **Comment Count**: Uses `metadata.comments` or calculated from likes
- **Share Button**: Available for all items

### 5. **Navigation**
- **Project Items**: Clicking navigates using `projectId`
- **Opportunity Items**: Clicking navigates using `opportunityId`
- **Campaign Items**: Clicking navigates using `campaignId`

## Type-Specific Expectations

### Project Items (`type: 'project'`)
```typescript
{
  type: 'project',
  title: 'New Project: [Project Title]',  // Prefix auto-removed in display
  projectId: 'project-uuid',
  metadata: {
    university: 'University Name',
    tags: ['tag1', 'tag2'],
    aspiraCategory: 'mentorships' | 'research' | 'community-service' | 'university-campaigns',
    team: [...],
    status: 'active' | 'closed' | 'planning',
    seekingSupport: ['support-type-1', 'support-type-2']
  }
}
```

### Opportunity Items (`type: 'opportunity'`)
```typescript
{
  type: 'opportunity',
  title: 'New Opportunity: [Opportunity Title]',  // Prefix auto-removed
  opportunityId: 'opportunity-uuid',
  metadata: {
    type: 'scholarship' | 'job' | 'internship' | 'fellowship',
    company: 'Company Name',
    remote: true | false,
    amount: {value: 5000, currency: 'USD', type: 'stipend'},
    experienceLevel: 'entry' | 'mid' | 'senior',
    applicants: 42
  }
}
```

### Success Story Items (`type: 'success_story'`)
```typescript
{
  type: 'success_story',
  title: 'Project Completed: [Project Title]',
  projectId: 'project-uuid',
  metadata: {
    completionDate: '2024-01-15',
    university: 'University Name',
    tags: [...]
  }
}
```

## API Endpoints

### Get Feed Items
**Endpoint**: `GET /api/feed`

**Query Parameters**:
- `type`: Filter by type (optional)
- `category`: Filter by category (optional)
- `limit`: Number of items to return (default: 50)
- `offset`: Pagination offset (default: 0)
- `sort`: 'recent' | 'trending' | 'significance' (default: 'recent')

**Response**:
```json
{
  "items": FeedItem[],
  "total": number,
  "offset": number,
  "limit": number
}
```

### Create Feed Item (Backend Auto-Creation)
When a project is created with `isPublic: true`, the backend automatically creates a feed item:
- **Endpoint**: `POST /api/projects` (creates feed item automatically)
- **Feed Item ID**: `feed_project_{projectId}`
- **Type**: `'project'`
- **Title**: `New Project: {projectTitle}`
- **Visibility**: `'public'`
- **Significance**: `'high'` if status is 'active', otherwise `'medium'`

## Feed Generation Logic

The feed uses a **priority system**:

1. **API Feed Items** (Highest Priority)
   - Fetched from `/api/feed`
   - These are feed items created by the backend
   - Most accurate and up-to-date

2. **Generated from Projects** (Fallback)
   - Generated from `/api/projects` if feed items don't exist
   - Only used if API feed items are empty
   - Creates feed items on-the-fly from project data

3. **Local Feed Items** (Lowest Priority)
   - Items added via `FeedService.createFeedItem()`
   - Admin highlights, user actions, etc.

## Sorting and Filtering

### Default Sort Order
1. **Pinned items first** (`isPinned === true`)
2. **Then by timestamp** (most recent first)

### Filtering Options
- **Visibility**: `'public'` | `'authenticated'` | `'all'`
- **Significance**: `'low'` | `'medium'` | `'high'` | `'critical'` | `'all'`
- **Category**: Filter by category string
- **User Filter**: Filter by author name/ID
- **Include Admin Highlights**: Boolean flag
- **Include Expired**: Boolean flag (for admin highlights with `metadata.expiresAt`)

## Visual Styling

### Type-Specific Colors
- **Projects**: Blue gradient (`bg-gradient-to-br from-blue-50 to-indigo-50`)
- **Opportunities**: Green gradient
- **Campaigns**: Purple gradient
- **Success Stories**: Gold gradient
- **Admin Highlights**: Purple left border (`border-l-4 border-l-purple-500`)

### Urgent Items
- Red ring border: `ring-2 ring-red-300 shadow-red-100`
- Pulsing badge with deadline

## Required vs Optional

### Always Required
- `id`, `type`, `title`, `timestamp`, `likes`, `location`, `category`
- `authorId`, `authorName`, `visibility`, `significance`

### Conditionally Required
- `projectId`: Required if `type === 'project'`
- `opportunityId`: Required if `type === 'opportunity'`
- `campaignId`: Required if `type === 'campaign'`
- `description`: Recommended for all types (shown in collapsible section)

### Recommended for Best UX
- `authorAvatar`: Better visual experience
- `metadata.tags`: For filtering and search
- `metadata.applicants`: For interest tracking
- `deadline`: For time-sensitive items

## Example Feed Item (Project)

```typescript
{
  id: "feed_project_7f338504-89de-4652-9834-5df3b31dbe60",
  type: "project",
  title: "New Project: adjasdfadfaefaefp",
  description: "Project description here",
  timestamp: "2024-01-15T10:30:00.000Z",
  likes: 0,
  location: "Test Location",
  category: "research",
  urgent: false,
  isLive: false,
  isPinned: false,
  isAdminCurated: false,
  authorId: "user-id-here",
  authorName: "Dev User",
  authorAvatar: undefined,
  projectId: "7f338504-89de-4652-9834-5df3b31dbe60",
  metadata: {
    university: "Test University",
    tags: ["test"],
    aspiraCategory: "research",
    team: [],
    status: "active"
  },
  visibility: "public",
  significance: "high",
  isAutoGenerated: true
}
```

## Notes

1. **Title Prefixes**: The feed automatically removes prefixes like "New Project: ", "New Opportunity: ", "New Campaign: " from titles when displaying
2. **Timestamp Format**: Should be ISO 8601 format, but the feed handles various formats
3. **Likes**: Initial value can be 0, but will be updated by user interactions
4. **Metadata**: Flexible object - can contain any additional fields needed
5. **Auto-Generated**: Items with `isAutoGenerated: true` are created by the system, not manually by admins

